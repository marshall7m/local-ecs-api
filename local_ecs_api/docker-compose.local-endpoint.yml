version: '3.4'
networks:
  ecs-local-network:
    name: ${ECS_NETWORK_NAME}
    driver: bridge
    ipam:
      config:
      - subnet: 169.254.170.0/24
        gateway: 169.254.170.1
services:
  ecs-local-endpoints:
    image: amazon/amazon-ecs-local-container-endpoints
    volumes:
    - /var/run/docker.sock:/var/run/docker.sock
    - /usr/bin/docker:/usr/bin/docker
    environment:
    - IAM_ENDPOINT
    - STS_ENDPOINT

    - AWS_PROFILE=${ECS_ENDPOINT_AWS_PROFILE}

    - AWS_ACCESS_KEY_ID=${ECS_ENDPOINT_AWS_ACCESS_KEY_ID}
    - AWS_REGION=${ECS_ENDPOINT_AWS_REGION}
    - AWS_SECRET_ACCESS_KEY=${ECS_ENDPOINT_AWS_SECRET_ACCESS_KEY}
    networks:
      ecs-local-network:
        ipv4_address: 169.254.170.2
